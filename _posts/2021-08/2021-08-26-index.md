---
layout: post
title: SQL Execution Plan
description: SQL Execution Plan
date: 2021-08-26 22:36
---

# 인덱스

- 인덱스는 데이터베이스에서 테이블에 대한 동작 속도를 높여주는 자료 구조를 말하며, 테이블 내의 1개 혹은 여러 개의 컬럼을 이용하여 생성할 수 있다.
- 키-필드만 갖고 있는 구조이기 때문에 저장하는 데 작은 디스크 공간만을 필요로 하는 것에 비해 보편적으로 테이블을 조회하는 속도와 성능을 크게 향상 시켜줄 수 있지만 관리하기 위해서는 추가 작업이 필요하고 잘못 사용하면 오히려 성능이 저하되는 역효과가 발생 할 수 있다.
- 인덱스는 고유 제약 조건을 실현하기 위해서도 사용된다. 고유 인덱스는 중복된 항목이 등록되는 것을 금지하기 때문에 인덱스의 대상인 테이블에서 고유성이 보장된다.

## 인덱스를 사용 하는 이유

- 인덱스는 풀 스캔에서는 아무런 의미가 없지만 WHERE 절을 사용할 때 진가를 발휘하며 일치하는 열을 빠르게 찾을 수 있다.
- join을 실행할 때 다른 테이블에서 열을 빠르게 추출할 수 있다.
- 특정하게 인덱스된 컬럼을 위한 MIN() 또는 MAX() 값을 빠르게 연산할 수 있다.

## 인덱스를 사용해야 하는 경우

- 데이터 양이 많고 검색이 변경보다 빈번한 경우
- 인덱스를 걸고자 하는 필드의 값이 다양한 값을 가지는 경우

## 인덱스를 어떻게 설정하는가

- 인덱스는 한 테이블당 3~5개 정도가 적당하다.
- 조회 시 자주 사용하고 고유한 값 위주로 설정하는 것이 좋다.
- 컬럼을 정해서 설정하는 것이므로 후보 컬럼의 특징을 잘 파악해야 한다. 아래의 4가지 기준을 사용하면 효율적으로 인덱스를 설정할 수 있다.

### 카디널리티

- 카디널리티는 컬럼에 사용되는 값의 중복 수치를 나타내는 지표로, 중복 정도가 낮으면 카디널리티도 낮다.
- 카디널리티가 높을 수록 인덱스 설정에 좋은 컬럼이다. (한 컬럼이 갖고 있는 값의 중복 정도가 낮을 수록 좋다.)
- 예시: 학생 테이블에 학번과 이름 컬럼이 있다고 가정
  - 학번은 학생마다 부여 받으므로 10개 값 모두 고유하여 중복 정도가 낮아 카디널리티도 낮다.
  - 이름은 동명이인이 있을 수 있어 카디널리티가 높다.

### 선택도

- 선택도가 낮을 수록 인덱스 설정에 좋은 컬럼이다.
- 선택도의 계산
  - 컬럼의 특정 값의 row 수 / 테이블의 총 row 수 \* 100
  - 컬럼의 값들의 평균 row 수 / 테이블의 총 row 수 \* 100
- 예시: 학생 테이블에 학번, 이름, 성별 컬럼이 있을 때, 학번은 고유하고, 이름은 2명씩 같고, 성별은 남녀 5:5 비율로 가정
  - 학번의 선택도 = 1/10 \* 100 = 10%
    - SELECT COUNT(1) FROM '학생' WHERE '학번' = 1; (모두 고유하므로 특정 값: 1)
  - 이름의 선택도 = 2/10 \* 100 = 20%
    - SELECT COUNT(1) FROM '학생' WHERE '이름' = '김철수'; (2명씩 같으므로 특정 값: 2)
  - 성별의 선택도 = 5/10 \* 100 = 50%
    - SELECT COUNT(1) FROM '학생' WHERE '성별' = 'F'; (5명씩 같으므로 특정 값: 5)
- 즉, 선택도는 특정 필드 값을 지정했을 때 선택되는 레코드 수를 테이블 전체 레코드 수로 나눈 것이다.

### 활용도

- 해당 컬럼이 실제 작업에서 얼마나 활용되는지에 대한 값으로, 활용도가 높을 수록 인덱스 설정에 좋은 컬럼이다.
- 수동 쿼리 조회, 로직과 서비스에서 쿼리를 날릴 때 WHERE 절에 자주 활용되는지를 판단하면 된다.

### 중복도

- 같은 컬럼에 대해 중복으로 인덱스를 설정하지 않는 것이 좋다.
- 인덱스에 대한 중복도가 없을 수록 인덱스 설정에 좋은 컬럼이다.

# References

- https://itrainbowm.tistory.com/20
- https://mangkyu.tistory.com/96
- https://yurimkoo.github.io/db/2020/03/14/db-index.html
